<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jiaxin Li(U77902942)">
<meta name="dcterms.date" content="2023-10-21">

<title>Stawberries: exploratory data analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="strawberry_eda_jiaxin_files/libs/clipboard/clipboard.min.js"></script>
<script src="strawberry_eda_jiaxin_files/libs/quarto-html/quarto.js"></script>
<script src="strawberry_eda_jiaxin_files/libs/quarto-html/popper.min.js"></script>
<script src="strawberry_eda_jiaxin_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="strawberry_eda_jiaxin_files/libs/quarto-html/anchor.min.js"></script>
<link href="strawberry_eda_jiaxin_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="strawberry_eda_jiaxin_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="strawberry_eda_jiaxin_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="strawberry_eda_jiaxin_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="strawberry_eda_jiaxin_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stawberries: exploratory data analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jiaxin Li(U77902942) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="assignment" class="level1">
<h1>Assignment</h1>
<p>Using our class discussions and this document as a starting point, produce an EDA report. The report should describe the data itself so that readers understand the data sources used in the report and how you cleaned and organized the data for analysis.</p>
<p>The sections below suggest how the report might be organized. The report should be succinct, communicating the information that you believe will be helpful to someone doing a fuller analysis of the data or using the data for model building. Implementation details should be included in commentary that is included in code.</p>
<p>Sections of the document as it was originally presented in class have been commented so that you can see them in the code.</p>
<section id="data-acquisition-and-assessment" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition-and-assessment">Data acquisition and assessment</h2>
<ul>
<li>Data sources<br>
</li>
<li>Assumptions and motivations</li>
</ul>
</section>
<section id="data-cleaning-and-organization" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-organization">Data cleaning and organization</h2>
<p>Outline the approach taked to clean and organize the data.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<section id="material-about-strawberries" class="level3">
<h3 class="anchored" data-anchor-id="material-about-strawberries">Material about strawberries</h3>
<p><a href="https://med.news.am/eng/news/13621/who-says-strawberries-may-not-be-so-safe-for-you.html">WHO says strawberries may not be so safe for you–2017March16</a></p>
<p><a href="https://www.ewg.org/foodnews/strawberries.php">Pesticides + poison gases = cheap, year-round strawberries 2019March20</a></p>
<p><a href="https://www.cdc.gov/hepatitis/outbreaks/2022/hav-contaminated-food/index.htm">Multistate Outbreak of Hepatitis A Virus Infections Linked to Fresh Organic Strawberries-2022March5</a></p>
<p><a href="https://issuu.com/mechlocal/docs/053123_mech_asf/s/25386339">Strawberry makes list of cancer-fighting foods-2023May31</a></p>
</section>
<section id="technical-references" class="level3">
<h3 class="anchored" data-anchor-id="technical-references">Technical references</h3>
<p>In their handbook <a href="https://cran.r-project.org/doc/contrib/de_Jonge+van_der_Loo-Introduction_to_data_cleaning_with_R.pdf">“An introduction to data cleaning with R” by Edwin de Jonge and Mark van der Loo</a>, de Jonge and van der Loo go into detail about specific data cleaning isssues and how to handle them in R.</p>
<p><a href="https://www.researchgate.net/profile/Heiko-Mueller/publication/228929938_Problems_methods_and_challenges_in_comprehensive_data_cleansing/links/09e415101b58541e2c000000/Problems-methods-and-challenges-in-comprehensive-data-cleansing.pdf">“Problems, Methods, and Challenges in Comprehensive Data Cleansing” by Heiko Müller and Johann-Christoph Freytag</a> is a good companion to the de Jonge and van der Loo handbook, offering additional insights.</p>
</section>
</section>
<section id="initial-questions" class="level2">
<h2 class="anchored" data-anchor-id="initial-questions">Initial questions</h2>
<ul>
<li>Initial questions about strawberries, the data, and about the work you are undertaking.</li>
</ul>
<p>The questions: (1) What is the degree of harmfulness of each chemical, which chemicals are more harmful and which are relatively harmless? (2) How are strawberries sold in different states and in different years? What about the use of chemicals? (3) Whether there is a correlation between different variables, e.g., whether strawberry sales are related to the year or the state in which they are located, etc.</p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>Describe the source and original condition of the data: organization, problems with the data that needed to be addressed and so on. Cite data sources.</p>
<p>The data set for this assignment has been selected from: <a href="https://quickstats.nass.usda.gov">USDA_NASS</a> <br> The data have been stored on NASS here: <a href="https://quickstats.nass.usda.gov/results/45FBC825-B104-38E2-9802-839F5F3C7036">USDA_NASS_strawb_2023SEP19</a></p>
<p>Make relevant observations in the document and in your code about data. Add commentary to the code so that anthoer analysts could use or extend your code.</p>
<p>Discusss missing data, inclding how you handled it. Be careful to point out where NA’s are being produced during processing and are not data missing in the original data.</p>
<p>Where it is relevant, include information of how you have organized the data for analysis. It might, for example, be helpful to know that there is both agricultural census data and survey data. It might be helpful to discuss data that appears to be redundant between these two sources.</p>
<p>Make sure you include details in your discussion and in your code about other data and information you used in your work. Cite sources and provide detail that would allow another analyst to reproduce your work.</p>
<!-- Read the file -->
<!-- Glimpse of strawberry data after dropping single-value columns. -->
<!-- ## Examine the data. How is it organized? -->
<!-- ### Is every line associated with a state? -->
<!-- ### Which state has the most rows? -->
<!-- The data is organized by state.   -->
<!-- The state with the most rows is CALIFORNIA. -->
<!-- ## Examine California data -->
<!-- ### List the composite columns  -->
<!-- Census: Data Item, Domain Category -->
<!-- Survey: Data Item, Domain, Domain Category -->
<!-- ## Separate CENSUS and SURVEY into two Data Frames -->
<!-- In the strawberry data frame,  -->
<!-- The CENSUS rows contains marketing, sales, and productiong data.  The SURVEY rows contain rows which may be redundant with the CENSUS rows and chemical application rows. -->
<!-- After splitting CENSUS and SURVEY rows into two data frames,  -->
<!-- finish organizing the CENSUS data first.  Then, organize the -->
<!-- SURVEY data frame splitting the marketing, and production data from the chemical application data. -->
<!-- # Complete with the census data frame -->
<!-- ## Separate composite columns and clean the Value column -->
<!-- Composite columns in the strwb_census: Data Item, Domain category -->
<!-- Column separators in CENSUS: ",", "-", ":" -->
<!-- ### Separate `Data Item` into columns by "," -->
<!-- ## Create a "Fresh Market" column -->
<!-- ## Create a "Process Market" column -->
<!-- Remove NA's from prop_acct, temp2, and temp3 -->
<!-- Combine temp2 with temp3 to create Metric column -->
<!-- remove  -->
<!-- relocate columns -->
<!-- ## The Value column transformation -->
<!-- NOTE -->
<!-- These plots were in early versions of the classroom notes. -->
<!-- In final versions of this document, they should be included in the EDA section. Note that the code will not run without editing. -->
<!-- ## plots   -->
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p>Once the data has been cleaned and organized, you must conduct your own EDA. Be sure to include a discussion of your analysis of the chemical information, including citations for data and other information you have used. Visualizations should play a key role in your analysis. Plots should be labeled and captioned.</p>
<!-- ## chemicals -->
<!-- ### carcinogens from WHO list -->
<!-- #### updated -->
<!-- [list from WHO?](https://ggle.io/6Eys) -->
<!-- Arsenic: A Group 1 carcinogen, or conclusive cause of cancer   -->
<!-- Ethylene oxide: A Group 1 carcinogen   -->
<!-- Lindane: A Group 1 carcinogen   -->
<!-- 2,3,7,8-tetrachlorodibenzo-p-dioxin (TCDD): A Group 1 carcinogen   -->
<!-- Diazinon: Classified as "probably carcinogenic"   -->
<!-- Glyphosate: Classified as "probably carcinogenic"    -->
<!-- Malathion: Classified as "probably carcinogenic"   -->
<!-- #### -->
<!-- Now produce two data frames using strwb_survey. -->
<!-- One will have market data similar to strwb_census -->
<!-- The second will have data about chemicals used by  -->
<!-- strawberry growers. -->
<!-- Use the survey market data to enrich the data you already have -->
<!-- from the census.   -->
<!-- Use the chemical data to explore the use of carcinogens to grown strawberries.  Use the World Health Organization's -->
<!-- list of carcinogens.  These lists site specific chemicals.  -->
<!-- For exampe: these chemicals are on WHO's list of known carcinogens: captafol, ethylene dibromide, glyphosate, malathion, diazinon and dichlorophenyltrichloroethane (DDT).   Note that the WHO lists are not specific to strawberries.  You must use available data resources to determine which are used in strawberry growing. -->
<!-- ## Clean and organize strwb_survey -->
<!-- ## Column analyses -->
<!-- ### Period -->
<!-- data item -->
<!-- Domain -->
<!-- Domain Category -->
<!-- drop 1-value columns strawberry chems  -->
<!-- mkt -->
<p style="page-break-before: always">
</p>
<section id="these-references-have-been-left-in-the-document-to-help-while-you-are-writing.-cite-those-you-use-and-drop-the-rest-from-the-final-document." class="level3">
<h3 class="anchored" data-anchor-id="these-references-have-been-left-in-the-document-to-help-while-you-are-writing.-cite-those-you-use-and-drop-the-rest-from-the-final-document.">These references have been left in the document to help while you are writing. Cite those you use and drop the rest from the final document.</h3>
<p><a href="https://quickstats.nass.usda.gov/tutorials">NASS help</a></p>
<p><a href="https://quickstats.nass.usda.gov/src/glossary.pdf">Quick Stats Glossary</a></p>
<p><a href="https://quickstats.nass.usda.gov/param_define">Quick Stats Column Definitions</a></p>
<p><a href="https://www.nass.usda.gov/Statistics_by_Subject/index.php?sector=CROPS">stats by subject</a></p>
<p>for EPA number lookup <a href="https://archive.epa.gov/pesticides/chemicalsearch/chemical/foia/web/html/128810.html">epa numbers</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=APPRIL_PUBLIC:2::::::">Active Pesticide Product Registration Informational Listing</a></p>
<p>pc number input <a href="https://ordspub.epa.gov/ords/pesticides/f?p=chemicalsearch:1">pesticide chemical search</a></p>
<p><a href="https://comptox.epa.gov/dashboard/">toxic chemical dashboard</a></p>
<p><a href="https://cfpub.epa.gov/si/si_public_record_report.cfm?Lab=NCCT&amp;dirEntryId=209598">ACToR – Aggregated Computational Toxicology Resource</a></p>
<p><a href="https://comptox.epa.gov/dashboard/chemical/details/DTXSID0020315">comptox dashboard</a></p>
<p><a href="https://pubchem.ncbi.nlm.nih.gov/">pubChem</a></p>
<p>The EPA PC (Pesticide Chemical) Code is a unique chemical code number assigned by the EPA to a particular pesticide active ingredient, inert ingredient or mixture of active ingredients.</p>
</section>
</section>
<section id="investigating-toxic-pesticides" class="level2">
<h2 class="anchored" data-anchor-id="investigating-toxic-pesticides">Investigating toxic pesticides</h2>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=chemicalsearch:1">start here with chem PC code</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=113:1::::RP,17,1::">step 2</a> to get label (with warnings) for products using the chemical</p>
<p><a href="https://www.ilo.org/dyn/icsc/showcard.home">International Chemical safety cards</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=113:1::::RP,17,1::">Pesticide Product and Label System</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=113:17::::::">Search by Chemical</a></p>
<p><a href="https://comptox.epa.gov/dashboard/">CompTox Chemicals Dashboard</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=APPRIL_PUBLIC:2::::::">Active Pesticide Product Registration Informational Listing</a></p>
<p><a href="https://www.osha.gov/chemicaldata">OSHA chemical database</a></p>
<p><a href="http://npic.orst.edu/ingred/">Pesticide Ingredients</a></p>
<p><a href="http://npic.orst.edu/NPRO/">NPIC Product Research Online (NPRO)</a></p>
<p><a href="http://npic.orst.edu/ingred/cheminfo.html">Databases for Chemical Information</a></p>
<p><a href="http://npic.orst.edu/ingred/active.html">Pesticide Active Ingredients</a></p>
<p><a href="https://www.epa.gov/tsca-inventory">TSCA Chemical Substance Inventory</a></p>
<p><a href="https://ordspub.epa.gov/ords/pesticides/f?p=CHEMICALSEARCH:3::::1,3,31,7,12,25:P3_XCHEMICAL_ID:2478">glyphosate</a></p>
<p>To</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_census)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_mkt)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_chem)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_mkt<span class="sc">$</span>temp1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PRICE RECEIVED" NA               "PRODUCTION"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_mkt<span class="sc">$</span>temp2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] " MEASURED IN $ / CWT"           " FRESH MARKET - PRICE RECEIVED"
 [3] " PROCESSING - PRICE RECEIVED"   " MEASURED IN $"                
 [5] " MEASURED IN CWT"               " FRESH MARKET - PRODUCTION"    
 [7] " FRESH MARKET"                  " NOT SOLD - PRODUCTION"        
 [9] " PROCESSING - PRODUCTION"       " PROCESSING"                   
[11] " UTILIZED - PRODUCTION"         " MEASURED IN TONS"             
[13] " BEARING - APPLICATIONS"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_mkt<span class="sc">$</span>temp3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA                                    
 [2] " MEASURED IN $ / CWT"                
 [3] " MEASURED IN $"                      
 [4] " UTILIZED - PRODUCTION"              
 [5] " MEASURED IN CWT"                    
 [6] " MEASURED IN TONS"                   
 [7] " MEASURED IN LB"                     
 [8] " MEASURED IN LB / ACRE / APPLICATION"
 [9] " MEASURED IN LB / ACRE / YEAR"       
[10] " MEASURED IN NUMBER"                 
[11] " MEASURED IN $ / TON"                </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_mkt<span class="sc">$</span>temp4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA                  " MEASURED IN CWT"  " AVG"             
[4] " MEASURED IN TONS"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_mkt<span class="sc">$</span>temp42)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "NOT SPECIFIED"           "FERTILIZER: (NITROGEN)" 
[3] "FERTILIZER: (PHOSPHATE)" "FERTILIZER: (POTASH)"   
[5] "FERTILIZER: (SULFUR)"   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem<span class="sc">$</span>temp4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA     " AVG"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem<span class="sc">$</span>temp23)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] " FUNGICIDE"   " HERBICIDE"   " INSECTICIDE" " OTHER"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(strwb_survey_chem$temp43)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>The numbers following the equals sign in these chemical substance records typically represent CAS numbers (Chemical Abstracts Service Registry Numbers). CAS numbers are a standardized numbering system used to uniquely identify chemical substances. Each CAS number is unique and serves the purpose of ensuring accurate identification and retrieval of information about a specific chemical substance. These numbers do not typically convey direct toxicity or hazard meanings; instead, they are used for the unique identification of chemicals in scientific and legal documents;</p></li>
<li><p>In the list of 171 chemical substance records, there are 89 unique CAS numbers. The reason there are not 171 unique CAS numbers is that some chemicals share the same CAS number. This can happen when multiple substances have similar chemical structures or active ingredients and are therefore assigned the same CAS number. CAS numbers are meant to uniquely identify chemical substances, but similar or equivalent substances may share the same CAS number in some cases.</p></li>
</ol>
<p>Then, In order to match the subsequent PC codes with their corresponding CAS numbers, all the PC numbers in the “Data Items” column are first extracted into a new separate column variable using regular expressions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS <span class="ot">&lt;-</span> strwb_survey_chem <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chemical_name =</span> <span class="fu">sub</span>(<span class="st">".*</span><span class="sc">\\</span><span class="st">((.*?)</span><span class="sc">\\</span><span class="st">s=.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, temp43),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">PCcodes =</span> <span class="fu">sub</span>(<span class="st">".*=</span><span class="sc">\\</span><span class="st">s(.*?)</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, temp43)) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, State, temp23, chemical_name, PCcodes, Value) </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(strwb_survey_chem_CAS)</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_chem_CAS)</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(strwb_survey_chem_CAS, path = "strwb_survey_chem_CAS.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem_CAS<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2021 2019 2018 2016</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem_CAS<span class="sc">$</span>State)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CALIFORNIA" "FLORIDA"    "OREGON"     "WASHINGTON"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem_CAS<span class="sc">$</span>temp23)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] " FUNGICIDE"   " HERBICIDE"   " INSECTICIDE" " OTHER"      </code></pre>
</div>
</div>
<p>Data visualisation was used here to initially explore the use of the four main groups of chemicals(“FUNGICIDE”, “HERBICIDE”, “INSECTICIDE”, “OTHER”) in different states in different years:</p>
<ol type="1">
<li><p>Here I created line plots using ggplot2 to visualize the proportion of different chemicals usage over time (from 2016 to 2018 to 2019 to 2021) for four different states (CALIFORNIA, FLORIDA, OREGON, WASHINGTON). The proportion is defined as the count of a specific kind of chemical divided by the sum of the counts of the four types of chemicals: ‘FUNGICIDE’, ‘HERBICIDE’, ‘INSECTICIDE’ and ‘OTHER’;</p></li>
<li><p>‘OREGON’ and ‘WASHINGTON’ have data for 2016 but not for other years, it is likely due to a lack of data availability for these states in the subsequent years (2018, 2019, and 2021) in the data set. In other words, the data set we are working with might not include information for those states in those specific years, resulting in no data points for those combinations.”</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>states_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CALIFORNIA"</span>, <span class="st">"FLORIDA"</span>, <span class="st">"OREGON"</span>, <span class="st">"WASHINGTON"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> strwb_survey_chem_CAS <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">%in%</span> states_of_interest)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>proportion_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fungicide_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">==</span> <span class="st">" FUNGICIDE"</span>),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">" FUNGICIDE"</span>, <span class="st">" HERBICIDE"</span>, <span class="st">" INSECTICIDE"</span>, <span class="st">" OTHER"</span>))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> <span class="fu">round</span>(fungicide_count <span class="sc">/</span> total_count, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lineplot1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(proportion_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> proportion, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, proportion)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"the proportion"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"The Proportion of the Utility of Fungicide"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_point(aes(label = sprintf("%.3f", proportion)), size = 3):
Ignoring unknown aesthetics: label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lineplot1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>states_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CALIFORNIA"</span>, <span class="st">"FLORIDA"</span>, <span class="st">"OREGON"</span>, <span class="st">"WASHINGTON"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> strwb_survey_chem_CAS <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">%in%</span> states_of_interest)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>proportion_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fungicide_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">==</span> <span class="st">" HERBICIDE"</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">" FUNGICIDE"</span>, <span class="st">" HERBICIDE"</span>, <span class="st">" INSECTICIDE"</span>, <span class="st">" OTHER"</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> <span class="fu">round</span>(fungicide_count <span class="sc">/</span> total_count, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lineplot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(proportion_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> proportion, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, proportion)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"the proportion"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"The Proportion of the Utility of HERBICIDE"</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_point(aes(label = sprintf("%.3f", proportion)), size = 3):
Ignoring unknown aesthetics: label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lineplot2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>states_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CALIFORNIA"</span>, <span class="st">"FLORIDA"</span>, <span class="st">"OREGON"</span>, <span class="st">"WASHINGTON"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> strwb_survey_chem_CAS <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">%in%</span> states_of_interest)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>proportion_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fungicide_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">==</span> <span class="st">" INSECTICIDE"</span>),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">" FUNGICIDE"</span>, <span class="st">" HERBICIDE"</span>, <span class="st">" INSECTICIDE"</span>, <span class="st">" OTHER"</span>))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> <span class="fu">round</span>(fungicide_count <span class="sc">/</span> total_count, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lineplot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(proportion_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> proportion, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, proportion)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"the proportion"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"The Proportion of the Utility of INSECTICIDE"</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_point(aes(label = sprintf("%.3f", proportion)), size = 3):
Ignoring unknown aesthetics: label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>lineplot3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>states_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CALIFORNIA"</span>, <span class="st">"FLORIDA"</span>, <span class="st">"OREGON"</span>, <span class="st">"WASHINGTON"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> strwb_survey_chem_CAS <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">%in%</span> states_of_interest)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the count of "FUNGICIDE" and the total count of all chemical types for each combination of "Year" and "State"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>proportion_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fungicide_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">==</span> <span class="st">" OTHER"</span>),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_count =</span> <span class="fu">sum</span>(temp23 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">" FUNGICIDE"</span>, <span class="st">" HERBICIDE"</span>, <span class="st">" INSECTICIDE"</span>, <span class="st">" OTHER"</span>))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> <span class="fu">round</span>(fungicide_count <span class="sc">/</span> total_count, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lineplot4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(proportion_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> proportion, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, proportion)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"the proportion"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"The Proportion of the Utility of OTHER"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_point(aes(label = sprintf("%.3f", proportion)), size = 3):
Ignoring unknown aesthetics: label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lineplot4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-29-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>desired_year <span class="ot">&lt;-</span> <span class="dv">2018</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>desired_state <span class="ot">&lt;-</span> <span class="st">"OREGON"</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(strwb_survey_chem_CAS, Year <span class="sc">==</span> desired_year <span class="sc">&amp;</span> State <span class="sc">==</span> desired_state)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(subset_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 6
# ℹ 6 variables: Year &lt;dbl&gt;, State &lt;chr&gt;, temp23 &lt;chr&gt;, chemical_name &lt;chr&gt;,
#   PCcodes &lt;chr&gt;, Value &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>desired_year <span class="ot">&lt;-</span> <span class="dv">2018</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>desired_state <span class="ot">&lt;-</span> <span class="st">"WASHINGTON"</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(strwb_survey_chem_CAS, Year <span class="sc">==</span> desired_year <span class="sc">&amp;</span> State <span class="sc">==</span> desired_state)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(subset_data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_mkt <span class="ot">&lt;-</span> strwb_survey_mkt[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(D</span><span class="sc">\\</span><span class="st">)"</span>, strwb_survey_mkt<span class="sc">$</span>Value), ]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_mkt<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(strwb_survey_mkt<span class="sc">$</span>Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 强制改变过程中产生了NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_mkt_grouped <span class="ot">&lt;-</span> strwb_survey_mkt <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, State, temp1b) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_value =</span> <span class="fu">mean</span>(Value)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Year', 'State'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_mkt_grouped)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following, I will match the PC codes of the chemical substances in the existing dataset to their corresponding CAS numbers, and then match them to the hazard classes of the corresponding chemical substances, with the help of the EXCEL datasheet provided by the professor, which contains CAS numbers and hazard classes.</p>
<p>And about the harms of different chemicals with different CAS numbers, we can learn from the file that prof shared that “INDEX. CLASS IFICATION OF PESTICIDE AC TIVE INGREDIENTS: Ia = Extremely hazardous; Ib= Highly hazardous; II=Moderately hazardous; III=Slightly hazardous; U = Unlikely to present acute hazard in normal use; FM =Fumigant, not classified; O = Obsolete as pesticide, not classified.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>cas_and_harm <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"CAS.xlsx"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># View(cas_and_harm)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>cas <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">unique</span>(strwb_survey_chem_CAS<span class="sc">$</span>PCcodes))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>PCcodes <span class="ot">&lt;-</span> cas[<span class="fu">nchar</span>(cas) <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"^[0-9]+$"</span>, cas)]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>PCcodes <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(PCcodes)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>PCcodes<span class="sc">$</span>cas_valid <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"23564-05-8"</span>, <span class="st">"15299-99-7"</span>, <span class="st">"38641-94-0"</span>, <span class="st">"70901-12-1"</span>, <span class="st">"13356-08-6"</span>, <span class="st">"153233-91-1"</span>, <span class="cn">NA</span>, <span class="st">"40487-42-1"</span>, <span class="st">"52315-07-8"</span>, <span class="st">"36734-19-7"</span>, <span class="st">"131929-60-7"</span>, <span class="cn">NA</span>, <span class="st">"42874-03-3"</span>, <span class="st">"70630-17-0"</span>, <span class="cn">NA</span>, <span class="st">"525-79-1"</span>, <span class="st">"57754-85-5"</span>, <span class="st">"67892-31-3"</span>, <span class="st">"112281-77-3"</span>, <span class="st">"99129-21-2"</span>, <span class="st">"161050-58-4"</span>, <span class="st">"108168-76-9"</span>, <span class="st">"60207-90-1"</span>, <span class="cn">NA</span>, <span class="st">"71751-41-2"</span>, <span class="st">"155569-91-8"</span>, <span class="st">"39148-24-8"</span>, <span class="st">"116714-46-6"</span>, <span class="st">"81777-89-1"</span>, <span class="st">"39515-41-8"</span>, <span class="st">"188425-85-6"</span>, <span class="st">"158062-67-0"</span>, <span class="st">"128639-02-1"</span>, <span class="st">"100784-20-1"</span>, <span class="st">"131860-33-8"</span>, <span class="st">"82657-04-3"</span>, <span class="st">"8000-78-0"</span>, <span class="st">"119446-68-3"</span>, <span class="st">"78587-05-0"</span>, <span class="st">"77182-82-2"</span>, <span class="st">"88671-89-0"</span>, <span class="st">"68694-11-1"</span>, <span class="st">"91465-08-6"</span>, <span class="st">"124-07-2"</span>, <span class="cn">NA</span>, <span class="st">"76674-21-0"</span>, <span class="st">"334-48-5"</span>, <span class="st">"81406-37-3"</span>, <span class="st">"66332-96-5"</span>, <span class="cn">NA</span>, <span class="st">"95737-68-1"</span>, <span class="st">"103361-09-7"</span>, <span class="st">"87674-68-8"</span>, <span class="st">"137497-61-1"</span>, <span class="cn">NA</span>, <span class="st">"122836-35-5"</span>, <span class="cn">NA</span>, <span class="st">"138261-41-3"</span>, <span class="st">"96489-71-3"</span>, <span class="st">"145701-23-1"</span>, <span class="st">"141517-21-7"</span>, <span class="st">"134098-61-6"</span>, <span class="st">"907204-31-3"</span>, <span class="st">"400882-07-7"</span>, <span class="st">"15708-41-5"</span>, <span class="cn">NA</span>, <span class="st">"146659-78-1"</span>, <span class="cn">NA</span>, <span class="st">"69327-76-0"</span>, <span class="st">"53112-28-0"</span>, <span class="st">"121552-61-2"</span>, <span class="st">"203313-25-1"</span>,<span class="st">"180409-60-3"</span>) </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View(PCcodes)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS <span class="ot">&lt;-</span> <span class="fu">merge</span>(strwb_survey_chem_CAS, PCcodes, <span class="at">by =</span> <span class="st">"PCcodes"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS <span class="ot">&lt;-</span> <span class="fu">merge</span>(strwb_survey_chem_CAS, cas_and_harm, <span class="at">by =</span> <span class="st">"cas_valid"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_chem_CAS)</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(strwb_survey_chem_CAS, path = "data_ with_cas_and_harms.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Handling of missing values in the “Value” variable: Calculate the mean value of the “Value” variable from valid values other than “(D)” and assign this calculated mean value to “(D)”, “(NA)” and “(Z)”. (Thanks for Aidan’s inspiration!!! He’s an angel and a genius!!!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>non_numeric_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(D)"</span>, <span class="st">"(NA)"</span>, <span class="st">"(Z)"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS<span class="sc">$</span>Value[strwb_survey_chem_CAS<span class="sc">$</span>Value <span class="sc">%in%</span> non_numeric_values] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(strwb_survey_chem_CAS<span class="sc">$</span>Value), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean(as.numeric(strwb_survey_chem_CAS$Value), na.rm = TRUE):
强制改变过程中产生了NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS<span class="sc">$</span>Value[<span class="fu">is.na</span>(strwb_survey_chem_CAS<span class="sc">$</span>Value)] <span class="ot">&lt;-</span> mean_value</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(strwb_survey_chem_CAS<span class="sc">$</span>Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 强制改变过程中产生了NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem_CAS<span class="sc">$</span>Value <span class="ot">&lt;-</span><span class="fu">round</span>(strwb_survey_chem_CAS<span class="sc">$</span>Value, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(strwb_survey_chem_CAS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    cas_valid PCcodes Year   State     temp23 chemical_name  Value harm_rank
1 103361-09-7  121011 2021 FLORIDA  HERBICIDE     CLETHODIM 38.188       III
2 103361-09-7  121011 2016  OREGON  HERBICIDE     CLETHODIM 38.188       III
3 103361-09-7  121011 2016  OREGON  HERBICIDE     CLETHODIM 38.188       III
4 103361-09-7  121011 2021 FLORIDA  HERBICIDE     CLETHODIM 38.188       III
5 103361-09-7  121011 2021 FLORIDA  HERBICIDE     CLETHODIM 38.188       III
6 103361-09-7  121011 2016  OREGON  HERBICIDE     CLETHODIM 38.188       III</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(strwb_survey_chem_CAS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cas_valid"     "PCcodes"       "Year"          "State"        
[5] "temp23"        "chemical_name" "Value"         "harm_rank"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(strwb_survey_chem_CAS<span class="sc">$</span>harm_rank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "III" "II"  "U"   "Ib" </code></pre>
</div>
</div>
<p>Here I want to explore data in data frame “strwb_survey_chem”, especially I’m curious about the relationships among variables like “State”, “Year”, “Value”. So I deal with the missing values in column “Value” first, then I could try to create some visualization plots and fit some models as below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>non_numeric_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(D)"</span>, <span class="st">"(NA)"</span>, <span class="st">"(Z)"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem<span class="sc">$</span>Value[strwb_survey_chem<span class="sc">$</span>Value <span class="sc">%in%</span> non_numeric_values] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(strwb_survey_chem<span class="sc">$</span>Value), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean(as.numeric(strwb_survey_chem$Value), na.rm = TRUE):
强制改变过程中产生了NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem<span class="sc">$</span>Value[<span class="fu">is.na</span>(strwb_survey_chem<span class="sc">$</span>Value)] <span class="ot">&lt;-</span> mean_value</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem<span class="sc">$</span>Value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(strwb_survey_chem<span class="sc">$</span>Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 强制改变过程中产生了NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>strwb_survey_chem<span class="sc">$</span>Value <span class="ot">&lt;-</span><span class="fu">round</span>(strwb_survey_chem<span class="sc">$</span>Value, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_chem)</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(strwb_survey_chem<span class="sc">$</span>Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> strwb_survey_chem, <span class="fu">aes</span>(<span class="at">x=</span>State, <span class="at">y=</span>Value, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Value situations of different states"</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 246 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> strwb_survey_chem, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Value, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Value situations of different states in different years"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 246 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-36-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then I try to explore whether the factors like state, year, chemical types could influence the Value, so I fit a generalized linear model(model1) and linear model(model2) below.</p>
<p>But in both outputs, many coefficients has relatively large standard deviation, and the t-stat indicates I fail to reject the Null Hypothesis(All the coefficients are equal to zero), so these two model don’t perform well. In the future, I will try more model to explore which model could fit well.</p>
<p>It turns out that the variable data are over dispersed so there are many outliers and the usual linear models don’t perform well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>载入需要的程辑包：Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is rstanarm version 2.21.4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- See https://mc-stan.org/rstanarm/articles/priors for changes to default priors!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- Default priors may change, so it's safest to specify priors, even if equivalent to the defaults.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- For execution on a local, multicore CPU with excess RAM we recommend calling</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>  options(mc.cores = parallel::detectCores())</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Value<span class="sc">~</span>Year <span class="sc">+</span> State <span class="sc">+</span> temp23, <span class="at">data=</span>strwb_survey_chem, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Info:
 function:     stan_glm
 family:       gaussian [identity]
 formula:      Value ~ Year + State + temp23
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help('prior_summary')
 observations: 2633
 predictors:   8

Estimates:
                     mean    sd      10%     50%     90%  
(Intercept)          250.7  1847.4 -2169.4   256.9  2646.5
Year                  -0.1     0.9    -1.3    -0.1     1.1
StateFLORIDA           3.0     3.5    -1.6     2.9     7.5
StateOREGON           11.1     9.6    -1.3    11.0    23.4
StateWASHINGTON        3.4     7.9    -6.7     3.3    13.3
temp23 HERBICIDE       8.7     5.5     1.7     8.7    15.8
temp23 INSECTICIDE    11.0     3.6     6.3    11.0    15.6
temp23 OTHER          15.4     5.1     8.9    15.4    21.9
sigma                 81.3     1.1    79.9    81.2    82.7

Fit Diagnostics:
           mean   sd   10%   50%   90%
mean_PPD 37.4    2.3 34.4  37.4  40.4 

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).

MCMC diagnostics
                   mcse Rhat n_eff
(Intercept)        30.2  1.0 3739 
Year                0.0  1.0 3740 
StateFLORIDA        0.1  1.0 4541 
StateOREGON         0.2  1.0 3753 
StateWASHINGTON     0.1  1.0 3696 
temp23 HERBICIDE    0.1  1.0 3830 
temp23 INSECTICIDE  0.1  1.0 3286 
temp23 OTHER        0.1  1.0 3720 
sigma               0.0  1.0 3449 
mean_PPD            0.0  1.0 3989 
log-posterior       0.1  1.0 1702 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Value<span class="sc">~</span>Year <span class="sc">+</span> State <span class="sc">+</span> temp23, <span class="at">data=</span>strwb_survey_chem)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Value ~ Year + State + temp23, data = strwb_survey_chem)

Residuals:
   Min     1Q Median     3Q    Max 
-43.97 -27.76  -5.31   0.34 871.60 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)         280.8700  1849.5516   0.152  0.87931   
Year                 -0.1250     0.9163  -0.136  0.89146   
StateFLORIDA          2.9301     3.4411   0.852  0.39456   
StateOREGON          11.0538     9.6052   1.151  0.24991   
StateWASHINGTON       3.2225     7.8243   0.412  0.68047   
temp23 HERBICIDE      8.5870     5.6532   1.519  0.12889   
temp23 INSECTICIDE   10.9387     3.6665   2.983  0.00288 **
temp23 OTHER         15.3162     4.9430   3.099  0.00197 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 81.24 on 2625 degrees of freedom
  (因为不存在，246个观察量被删除了)
Multiple R-squared:  0.005629,  Adjusted R-squared:  0.002977 
F-statistic: 2.123 on 7 and 2625 DF,  p-value: 0.03821</code></pre>
</div>
</div>
<p>The last part of my EDA is about exploring data in the “strwb_survey_mkt”, to explore the relationships among “state”, “year”, “Value”, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">as.numeric</span>(strwb_survey_mkt<span class="sc">$</span>Value), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>strwb_survey_mkt<span class="sc">$</span>Value[<span class="fu">is.na</span>(strwb_survey_mkt<span class="sc">$</span>Value)] <span class="ot">&lt;-</span> mean_value</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>strwb_survey_mkt<span class="sc">$</span>Value <span class="ot">&lt;-</span><span class="fu">round</span>(strwb_survey_mkt<span class="sc">$</span>Value, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View(strwb_survey_mkt)</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Value<span class="sc">~</span>Year <span class="sc">+</span> State, <span class="at">data=</span>strwb_survey_mkt, <span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Info:
 function:     stan_glm
 family:       gaussian [identity]
 formula:      Value ~ Year + State + temp23
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help('prior_summary')
 observations: 2633
 predictors:   8

Estimates:
                     mean    sd      10%     50%     90%  
(Intercept)          250.7  1847.4 -2169.4   256.9  2646.5
Year                  -0.1     0.9    -1.3    -0.1     1.1
StateFLORIDA           3.0     3.5    -1.6     2.9     7.5
StateOREGON           11.1     9.6    -1.3    11.0    23.4
StateWASHINGTON        3.4     7.9    -6.7     3.3    13.3
temp23 HERBICIDE       8.7     5.5     1.7     8.7    15.8
temp23 INSECTICIDE    11.0     3.6     6.3    11.0    15.6
temp23 OTHER          15.4     5.1     8.9    15.4    21.9
sigma                 81.3     1.1    79.9    81.2    82.7

Fit Diagnostics:
           mean   sd   10%   50%   90%
mean_PPD 37.4    2.3 34.4  37.4  40.4 

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).

MCMC diagnostics
                   mcse Rhat n_eff
(Intercept)        30.2  1.0 3739 
Year                0.0  1.0 3740 
StateFLORIDA        0.1  1.0 4541 
StateOREGON         0.2  1.0 3753 
StateWASHINGTON     0.1  1.0 3696 
temp23 HERBICIDE    0.1  1.0 3830 
temp23 INSECTICIDE  0.1  1.0 3286 
temp23 OTHER        0.1  1.0 3720 
sigma               0.0  1.0 3449 
mean_PPD            0.0  1.0 3989 
log-posterior       0.1  1.0 1702 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Value<span class="sc">~</span>Year <span class="sc">+</span> State, <span class="at">data=</span>strwb_survey_mkt)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Value ~ Year + State + temp23, data = strwb_survey_chem)

Residuals:
   Min     1Q Median     3Q    Max 
-43.97 -27.76  -5.31   0.34 871.60 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)         280.8700  1849.5516   0.152  0.87931   
Year                 -0.1250     0.9163  -0.136  0.89146   
StateFLORIDA          2.9301     3.4411   0.852  0.39456   
StateOREGON          11.0538     9.6052   1.151  0.24991   
StateWASHINGTON       3.2225     7.8243   0.412  0.68047   
temp23 HERBICIDE      8.5870     5.6532   1.519  0.12889   
temp23 INSECTICIDE   10.9387     3.6665   2.983  0.00288 **
temp23 OTHER         15.3162     4.9430   3.099  0.00197 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 81.24 on 2625 degrees of freedom
  (因为不存在，246个观察量被删除了)
Multiple R-squared:  0.005629,  Adjusted R-squared:  0.002977 
F-statistic: 2.123 on 7 and 2625 DF,  p-value: 0.03821</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(strwb_survey_mkt<span class="sc">$</span>Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> strwb_survey_mkt, <span class="fu">aes</span>(<span class="at">x=</span>State, <span class="at">y=</span>Value, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Value situations of different states"</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-38-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> strwb_survey_mkt, <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Value, <span class="at">color =</span> State)) <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Value situations of different states in different years"</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="strawberry_eda_jiaxin_files/figure-html/unnamed-chunk-38-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>